name: CodeQL Analysis

on:
  push:
    branches:
      - main  # ou 'master', selon le nom de votre branche principale
  pull_request:
    branches:
      - main  # ou 'master', selon le nom de votre branche principale

jobs:
  analyze:
    name: Analyze Code with CodeQL
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4  # Cette action clone le dépôt pour l'analyse

      # Installer Java (JDK 17 ou une autre version si nécessaire)
      - name: Set up JDK 17
        uses: actions/setup-java@v2
        with:
          java-version: '17'

      # Installer Maven
      - name: Set up Maven
        uses: actions/setup-java@v2
        with:
          java-version: '17'
          maven-version: '3.8.1'  # Assurez-vous que cette version correspond à la version utilisée dans votre projet

      # Construire le projet avec Maven (ou Gradle si c'est ce que vous utilisez)
      - name: Build with Maven
        run: mvn clean install -DskipTests  # Assurez-vous que Maven est correctement configuré et que le projet peut être construit

      - name: Set up CodeQL
        uses: github/codeql-action/setup-codeql@v3  # Installe et configure CodeQL

      - name: Initialize CodeQL database
        run: |
          # Cette étape n'est plus automatique, on initialise manuellement le CodeQL DB
          codeql database create --language=java --source-root=.

      - name: Perform CodeQL analysis
        run: |
          # Lance l'analyse CodeQL sur le code source
          codeql analyze --database=codeql-database --output=codeql-results.sarif

      - name: Upload CodeQL results
        uses: github/codeql-action/upload-artifact@v2  # Télécharge les résultats de l'analyse en tant qu'artifact
